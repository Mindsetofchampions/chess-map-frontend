/* Map GL CSS - Mapbox and MapLibre */
@import "mapbox-gl/dist/mapbox-gl.css";
@import "maplibre-gl/dist/maplibre-gl.css";

/* Tailwind CSS base styles */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom base styles for better typography and layout */
@layer base {
  :root {
    /* Hint browsers to render native form controls in dark mode */
    color-scheme: dark;
  }

  html {
    font-family:
      "Inter",
      system-ui,
      -apple-system,
      sans-serif;
  }

  body {
    @apply antialiased text-gray-100 bg-gradient-to-br from-dark-primary via-dark-secondary to-dark-tertiary;
    margin: 0;
    padding: 0;
  }

  * {
    box-sizing: border-box;
  }
}
/* Mobile viewport height and safe-area helpers */
@layer utilities {
  .h-dvh {
    height: 100dvh;
  }
  .min-h-dvh {
    min-height: 100dvh;
  }
  .pt-safe {
    padding-top: env(safe-area-inset-top);
  }
  .pb-safe {
    padding-bottom: env(safe-area-inset-bottom);
  }
  .fixed-bottom-safe {
    position: fixed;
    left: 0;
    right: 0;
    bottom: env(safe-area-inset-bottom);
  }
}

/* Custom component styles */
@layer components {
  /* Secondary button style for neutral actions */
  .btn-secondary {
    @apply bg-glass border-glass text-white rounded-full px-5 py-2 hover:bg-glass-dark transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed;
  }

  /* Dark themed selects globally */
  select,
  .select-dark {
    /* Increased contrast for readability */
    @apply bg-gray-900/90 text-gray-100 border border-white/30 rounded;
  }

  select:focus {
    @apply outline-none ring-2 ring-electric-blue-400 border-white/40;
  }

  /* High-contrast menu/popup surfaces where possible */
  [role="dialog"] {
    /* Force readable contrast for modal/popup content without changing component classNames */
    background: rgba(17, 24, 39, 0.92) !important; /* gray-900 */
    color: #e5e7eb !important; /* gray-200 */
    border: 1px solid rgba(255, 255, 255, 0.18) !important;
    -webkit-backdrop-filter: blur(10px);
    backdrop-filter: blur(10px);
  }

  /* Buttons/links inside popups should have visible focus outline */
  [role="dialog"] button,
  [role="dialog"] a {
    @apply focus:outline-none focus:ring-2 focus:ring-electric-blue-400 focus:ring-offset-0;
  }

  /* Typography tweaks inside popups for readability */
  [role="dialog"] h1,
  [role="dialog"] h2,
  [role="dialog"] h3 {
    color: #ffffff;
  }
  [role="dialog"] .opacity-80,
  [role="dialog"] .text-muted-foreground {
    color: #cbd5e1; /* slate-300 */
  }

  /* Elevate contrast for common glass combos used by inline tooltips/popovers */
  .backdrop-blur-2xl.bg-white\/30,
  .backdrop-blur-xl.bg-white\/10 {
    background: rgba(17, 24, 39, 0.9) !important; /* gray-900 */
    color: #e5e7eb !important; /* gray-200 */
    border-color: rgba(255, 255, 255, 0.25) !important;
  }

  /* High-contrast dropdown/listbox/menus */
  [role="menu"],
  [role="listbox"],
  .dropdown-menu,
  .menu {
    background: rgba(17, 24, 39, 0.98);
    color: #f3f4f6; /* gray-100 */
    border: 1px solid rgba(255, 255, 255, 0.2);
    -webkit-backdrop-filter: blur(8px);
    backdrop-filter: blur(8px);
  }

  [role="menu"] [role="menuitem"],
  [role="listbox"] [role="option"] {
    color: inherit;
  }

  /* Placeholder contrast */
  input::placeholder,
  textarea::placeholder,
  .select-dark::placeholder {
    color: #cbd5e1; /* slate-300 */
    opacity: 0.9;
  }

  /* Dropdown option panel colors (browser support varies) */
  option {
    background-color: #111827; /* gray-900 */
    color: #f9fafb; /* gray-50 */
  }
  /* Enhanced glassmorphism effect */
  .glassmorphism {
    @apply bg-white/30 backdrop-blur-md border border-white/20 shadow-xl;
  }

  /* Smooth transitions for interactive elements */
  .transition-all {
    transition-property: all;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 300ms;
  }

  /* Map container specific styles */
  .mapboxgl-map,
  .maplibregl-map {
    font-family: inherit;
    /* Prevent flashing during initialization */
    background-color: #0a0a0f;
    /* Remove opacity transitions to avoid periodic flicker when style/layers update */
    transition: none !important;
  }
}

/* Ensure proper canvas sizing */
.mapboxgl-canvas,
.maplibregl-canvas {
  outline: none;
  display: block;
}

/* Loading state for map container */
.mapboxgl-map.loading {
  opacity: 0;
}

.mapboxgl-map.loaded {
  opacity: 1;
}

/* Mapbox GL overrides for better integration */
.mapboxgl-popup {
  @apply font-sans;
}

.mapboxgl-popup-content {
  @apply rounded-lg shadow-lg;
}

.mapboxgl-ctrl-group {
  @apply rounded-lg shadow-md;
}

.mapboxgl-ctrl button {
  @apply transition-colors duration-200;
}

/* Attribution styling */
.mapboxgl-ctrl-attrib {
  @apply text-xs;
}

/* Ensure Mapbox canvas displays properly */
.mapboxgl-map,
.maplibregl-map {
  width: 100% !important;
  height: 100% !important;
  position: relative !important;
}

.mapboxgl-canvas-container,
.maplibregl-canvas-container {
  width: 100% !important;
  height: 100% !important;
  position: relative !important;
}

.mapboxgl-canvas,
.maplibregl-canvas {
  width: 100% !important;
  height: 100% !important;
  display: block !important;
  position: relative !important;
}

/* Fix for Mapbox rendering issues */
.mapboxgl-map canvas,
.maplibregl-map canvas {
  position: relative !important;
  width: 100% !important;
  height: 100% !important;
}

/* Ensure map container has proper stacking context */
.map-container {
  position: relative;
  isolation: isolate;
}

/* Remove custom fade classes to prevent unintended opacity toggles that cause flicker */

/* Custom Mapbox/MapLibre popup styling (high-contrast) */
.mapbox-popup-glass .mapboxgl-popup-content,
.mapbox-popup-glass .maplibregl-popup-content {
  background: rgba(17, 24, 39, 0.92) !important; /* gray-900 */
  color: #e5e7eb !important; /* gray-200 */
  -webkit-backdrop-filter: blur(12px) !important;
  backdrop-filter: blur(12px) !important;
  border: 1px solid rgba(255, 255, 255, 0.18) !important;
  border-radius: 12px !important;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45) !important;
  padding: 0 !important;
}

.mapbox-popup-glass .mapboxgl-popup-tip,
.mapbox-popup-glass .maplibregl-popup-tip {
  border-top-color: rgba(17, 24, 39, 0.92) !important;
}

.mapbox-popup-glass .mapboxgl-popup-close-button,
.mapbox-popup-glass .maplibregl-popup-close-button {
  color: #e5e7eb !important;
  font-size: 16px !important;
  padding: 8px !important;
  border-radius: 50% !important;
  background: rgba(255, 255, 255, 0.08) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  backdrop-filter: blur(10px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
  right: 8px !important;
  top: 8px !important;
}

.mapbox-popup-glass .mapboxgl-popup-close-button:hover,
.mapbox-popup-glass .maplibregl-popup-close-button:hover {
  background: rgba(255, 255, 255, 0.18) !important;
  color: #fff !important;
}

/* Ensure headings and subtle text inside popups are legible */
.mapbox-popup-glass .popup-title {
  color: #ffffff !important;
  font-weight: 700;
}
.mapbox-popup-glass .popup-subtle {
  color: #cbd5e1 !important;
}
.mapbox-popup-glass .popup-desc {
  color: #e5e7eb !important;
}
.mapbox-popup-glass .popup-logo {
  width: 36px;
  height: 36px;
  object-fit: cover;
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.06);
}
/* Custom scrollbar styles */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  /* Darken to avoid glare against dark UI */
  @apply bg-gray-800 rounded-full;
}

::-webkit-scrollbar-thumb {
  @apply bg-gray-400 rounded-full hover:bg-gray-500;
}

/* Loading animation */
@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Print styles */
@media print {
  body {
    background: #fff !important;
    color: #000 !important;
  }
  .print\:hidden {
    display: none !important;
  }
  .print\:overflow-visible {
    overflow: visible !important;
  }
  table {
    border-collapse: collapse !important;
  }
  th,
  td {
    border: 1px solid #000 !important;
    color: #000 !important;
  }
}
